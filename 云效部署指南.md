# 华晟复材网站云效部署指南

本文档提供了如何通过阿里云效（Alibaba Cloud DevOps）平台发布华晟复材科技网站的详细步骤。

## 前置准备

1. 阿里云账号
2. 已购买的域名（可选，如需自定义域名）
3. 网站代码仓库（GitHub或阿里云代码仓库）

## 一、创建云效项目

1. 登录[阿里云效平台](https://flow.aliyun.com/)
2. 点击「创建项目」
3. 选择「前端应用」项目模板
4. 填写项目名称：`huasheng-website`
5. 填写项目描述：`西安华晟复材科技有限公司官方网站`
6. 点击「确定」创建项目

## 二、代码仓库配置

### 方案1：使用GitHub仓库

1. 在云效项目中，进入「代码」>「代码源」
2. 点击「添加代码源」>「GitHub」
3. 按照提示授权并连接GitHub账号
4. 选择包含华晟复材网站代码的GitHub仓库

### 方案2：使用阿里云代码仓库

1. 在云效项目中，进入「代码」>「代码源」
2. 点击「创建代码库」
3. 填写代码库名称：`huasheng-website`
4. 选择「导入已有仓库」，输入GitHub仓库地址
5. 点击「确定」创建

## 三、配置构建流水线

1. 在云效项目中，进入「流水线」
2. 点击「创建流水线」
3. 选择「前端应用发布」模板
4. 填写流水线名称：`huasheng-website-deploy`
5. 配置源代码阶段：
   - 选择上一步添加的代码源
   - 选择分支：`main`或`master`

6. 配置构建阶段：
   - 选择Node.js构建环境，版本选择16.x或更高
   - 在构建命令中填写：
   ```bash
   npm install
   npm run build
   ```
   - 构建物上传路径：`dist`

7. 配置部署阶段：
   - 选择「部署到OSS」
   - 选择或创建OSS存储桶
   - 设置目标路径：`/`

8. 点击「保存并执行」

## 四、配置OSS静态网站托管

1. 登录[阿里云OSS控制台](https://oss.console.aliyun.com/)
2. 找到用于部署的存储桶，点击「管理」
3. 在左侧导航栏，选择「基础设置」>「静态页面」
4. 开启「静态页面」功能
5. 默认首页设置为：`index.html`
6. 默认404页设置为：`index.html`（SPA应用）或自定义404页面
7. 点击「保存」

## 五、配置自定义域名（可选）

1. 在OSS控制台，选择「传输管理」>「域名管理」
2. 点击「绑定域名」
3. 输入您已购买的域名
4. 选择「阿里云CDN加速」
5. 按照提示完成域名备案和CNAME解析设置

## 六、配置HTTPS（可选）

1. 在阿里云SSL证书控制台申请或上传SSL证书
2. 在CDN控制台为您的域名配置HTTPS证书
3. 开启HTTPS强制跳转

## 七、自动化部署配置

1. 返回云效流水线配置
2. 开启「代码变更自动触发」功能
3. 设置触发分支规则，如：`main`或`master`

## 八、验证部署

1. 手动触发一次流水线执行
2. 等待流水线执行完成
3. 通过OSS提供的访问地址或您配置的自定义域名访问网站

## 注意事项

1. 确保`astro.config.mjs`中的`base`路径配置正确：
   - 如果部署到OSS根目录，可以将`base`设置为`/`
   - 如果部署到子目录，需要设置对应的路径

2. 确保所有静态资源路径正确，建议使用相对路径

3. 如遇到跨域问题，需在OSS存储桶中配置CORS规则

## 常见问题排查

1. **网站加载缓慢**：检查资源大小，考虑启用CDN加速和资源压缩

2. **资源404错误**：检查资源路径是否正确，特别是`base`路径配置

3. **部署失败**：检查构建日志，确保所有依赖正确安装

4. **样式丢失**：检查CSS文件路径，确保正确引用

## 联系支持

如在部署过程中遇到问题，可联系阿里云技术支持或参考[云效官方文档](https://help.aliyun.com/product/72570.html)。